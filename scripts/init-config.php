<?php declare(strict_types=1);
$root=__DIR__.'/../dist/app/config'; if(!is_dir($root)){fwrite(STDERR,"Config dir not found: $root\n"); exit(1);} $map=['config-dist.yml'=>'config.yml','db-dist.yml'=>'db.yml','google-dist.yml'=>'google.yml','instagram-dist.yml'=>'instagram.yml','twitter-dist.yml'=>'twitter.yml','vk-dist.yml'=>'vk.yml','yandex-dist.yml'=>'yandex.yml']; foreach($map as $a=>$b){$s=$root.'/'.$a;$d=$root.'/'.$b; if(!file_exists($d)&&file_exists($s)){copy($s,$d); echo "Created $b from $a\n";}} $db=$root.'/db.yml'; if(file_exists($db)){ $c=file_get_contents($db); $rep={'/host:\s*.*/':'host: '.getenv('DB_HOST')?:'db','/dbname:\s*.*/':'dbname: '.getenv('DB_NAME')?:'cms','/user:\s*.*/':'user: '.getenv('DB_USER')?:'cms','/password:\s*.*/':'password: '.getenv('DB_PASS')?:'cms'}; foreach($rep as $r=>$v){$c=preg_replace($r,$v,$c);} file_put_contents($db,$c); echo "Updated db.yml\n"; } echo "Config init complete.\n";