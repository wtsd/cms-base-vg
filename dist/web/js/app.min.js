/*! base 2016-12-26 */
function addLocationsToMap(a,b){var c,d,e=0,f=0;for(d=0;d<a.length;d++)e+=a[d][1],f+=a[d][2];e/=a.length,f/=a.length,map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:b,center:new google.maps.LatLng(e,f),mapTypeId:google.maps.MapTypeId.ROADMAP});var g=new google.maps.InfoWindow;for(d=0;d<a.length;d++)c=new google.maps.Marker({position:new google.maps.LatLng(a[d][1],a[d][2]),map:map}),markers.push(c),google.maps.event.addListener(c,"click",function(b,c){return function(){g.setContent(a[c][0]),g.open(map,b)}}(c,d))}function initializeMap(){var a=9;addLocationsToMap(locations,a),$(".address-block").on("mouseover",function(){var a=$(this).attr("data-marker-id"),b=new google.maps.MarkerImage("/web/images/map-icon.png",new google.maps.Size(20,34),new google.maps.Point(0,0),new google.maps.Point(9,34));markers[a].setIcon(b)}),$(".address-block").on("mouseout",function(){var a=$(this).attr("data-marker-id");markers[a].setIcon()})}function doSubscribe(a){$.ajax({type:"post",url:"/api/signup/subscribe",data:{email:a},success:function(a){"ok"==a.status?$(".frmSubs").html(a.msg):($(".subscriptionEmail").removeAttr("disabled"),alert(a.msg))},beforeSend:function(){$(".subscriptionEmail").attr("disabled","disabled")},dataType:"json",cache:!1,error:function(){}})}function cartGeneralRoutine(){$(".cartCount").on("mouseover",function(){}),$(".cart-contents-float").on("mouseout",function(){$(".cart-contents-float").hide()}),$("input.quantity").on("change",function(){var a=$(this),b=a.attr("data-offer"),c=a.val(),d=a.parents("tr");$.ajax({type:"post",url:"/api/v1/cart/quantity",data:{offer_id:b,quantity:c},success:function(a){"ok"==a.status?(d.children(".price-subtot").text(a.subtot),$(".cartSum").html(a.sum),$(".error").html(a.msg).show(),$(".cartCount").html("Корзина "+a.cartCount+" ("+a.sum+" руб.)")):($(".error").hide(),$(".notification").html(a.msg).show(),$("#fbck_frm").hide())},dataType:"json",cache:!1,error:function(){}})}),$(".addToCart").on("click",function(a){{var b=$(this),c=0,d=b.parents(".offer-item, .single-offer");$(".menu-right")}c=b.attr("data-offer-id")>0?b.attr("data-offer-id"):$("#offer_id").val(),b.hasClass("active")?(b.removeClass("active"),console.log("REMOVE FROM CART")):(a.preventDefault(),$.ajax({type:"post",url:"/api/v1/cart/add",data:{offer_id:c,quantity:1},success:function(a){"ok"==a.status?($(".cart-modal").modal(),setTimeout(function(){$(".cart-modal").modal("hide")},5e3),$(".error").html(a.msg).show(),$(".cartCount").html("Корзина "+a.cartCount+" ("+a.sum+" руб.)"),$(".msg",d).html('Товар добавлен! <a href="/cart/">Оформить заказ</a>.').show(),setTimeout(function(){$(".msg",d).hide("slide")},5e3)):($(".error").hide(),$(".notification").html(a.msg).show(),$("#fbck_frm").hide())},dataType:"json",cache:!1,error:function(){}}))}),$(".clearCart").on("click",function(a){var b=$(this);b.addClass("active"),a.preventDefault(),$.ajax({type:"post",url:"/api/v1/cart/clear",success:function(a){$(".offersCount").html("0"),$(".offersSum").html("0"),$(".cart-offers").html(""),"ok"==a.status?($(".error").html(a.msg).show(),$(".cartCount").html("Корзина пуста")):($(".error").hide(),$(".notification").html(a.msg).show(),$("#fbck_frm").hide())},dataType:"json",cache:!1,error:function(){}})}),$(".removeFromCart").on("click",function(a){var b=$(this).attr("data-offer");a.preventDefault(),$.ajax({type:"post",url:"/api/v1/cart/remove",data:{offer_id:b},success:function(a){$(".offer_"+b).remove(),"ok"==a.status?($(".error").html(a.msg).show(),$(".cartCount").html(a.cartCount)):($(".error").hide(),$(".notification").html(a.msg).show(),$("#fbck_frm").hide())},dataType:"json",cache:!1,error:function(){}})}),$(".quantity-change").on("click",function(a){a.preventDefault();var b=$(this),c=b.attr("data-offer"),d=$('input.quantity[data-offer="'+c+'"]'),e=d.val();"sub"==b.attr("data-action")&&e>1&&d.val(parseInt(e)-1),"add"==b.attr("data-action")&&d.val(parseInt(e)+1);var f=b.parents("tr"),g=d.val();$.ajax({type:"post",url:"/api/v1/cart/quantity",data:{offer_id:c,quantity:g},success:function(a){"ok"==a.status?(f.children(".price-subtot").text(a.subtot),$(".cartSum").html(a.sum),$(".error").html(a.msg).show(),$(".cartCount").html("Корзина "+a.cartCount+" ("+a.sum+" руб.)")):($(".error").hide(),$(".notification").html(a.msg).show(),$("#fbck_frm").hide())},dataType:"json",cache:!1,error:function(){}})})}function startOfferRoutine(){$(".single-offer .previews .thumb").on("click",function(a){a.preventDefault();var b=$(this).attr("src");$(".img img.main").attr("src",b)});var a=document.location.toString();a.match("#")&&$(".nav-tabs a[href=#"+a.split("#")[1]+"]").tab("show"),$(".nav-tabs a").on("shown",function(a){window.location.hash=a.target.hash})}function commentsRoutine(){$(".comments-container .pagination a").on("click",function(a){a.preventDefault();var b=$(this),c=$(".comments-container"),d=b.data("page"),e=$(".comments").data("type"),f=$(".comments").data("fid"),g={type:e,page:d,fid:f};$.ajax({method:"post",url:"/api/comment/get/",data:g,dataType:"json",success:function(a){"ok"==a.status?(c.html(a.html),commentsRoutine()):alert(a.msg)}})})}var locations=[],map,markers=[];$(document).ready(function(){"use strict";$(".subscriptionEmail").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val();doSubscribe(b)}}),$(".doSubscribe").on("click",function(a){a.preventDefault();var b=$(".subscriptionEmail").val();doSubscribe(b)}),$("a[href='#top']").hide(),$(window).bind("scroll",function(){$(this).scrollTop()>200?$("a[href='#top']").show():$("a[href='#top']").hide()}),$("a[href='#top']").click(function(){return $("html, body").animate({scrollTop:0},"slow"),!1}),$(".images").photobox("a",{time:0}),cartGeneralRoutine(),$("#map-canvas").length>0&&initializeMap(),$("#pull-menu").on("click",function(a){a.preventDefault();var b=$(this).siblings("ul");console.log(b),b.slideToggle()}),$(".req-callback").on("click",function(a){a.preventDefault();var b=$(".callback");b.modal("show")}),$("pre code").each(function(a,b){hljs.highlightBlock(b)}),$(".frm_feedback").on("submit",function(a){a.preventDefault();var b=$(this),c=$(".notification"),d={token:$("#token").val(),name:$("#name").val(),email:$("#email").val(),msg:$("#msg").val()};$.ajax({type:"post",url:"/api/v1/feedback/send/",data:d,success:function(a){alert(a.msg),c.html(a.msg).show(),"ok"==a.status?b.hide():$(".error").hide()},dataType:"json",cache:!1})}),$(".comment-frm").on("submit",function(a){a.preventDefault();var b=$(this),c=($(".comments"),$("<div></div>").addClass("comment"),$('textarea[name="comment"]',b).val(),$('input[name="name"]',b).val(),$(this).data("fid"),$(this).data("type"),$("input, textarea",b).serializeArray()),d={};c.forEach(function(a){d[a.name]=a.value}),$.ajax({method:"post",url:"/api/comment/add/",data:d,dataType:"json",success:function(a){"ok"==a.status?($('textarea[name="comment"]',b).val(""),$('input[name="name"]',b).val(""),$(".comments-container").html(a.html),$(".comments-count").html(1==a.count?"("+a.count+")":a.count),commentsRoutine(),grecaptcha.reset()):(alert(a.msg),grecaptcha.reset())}})}),$(".affix-el").affix(),commentsRoutine()}),$(window).scroll(function(){$(".scroll-vis").each(function(a,b){var b=$(b);b.visible(!0)&&b.addClass("anim")})});